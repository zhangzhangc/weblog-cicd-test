<template>
    <div class="mt-14">
        <h2 class="flex justify-center items-center mb-7 text-gray-500">ÂÖ®ÈÉ®ËØÑËÆ∫<span>({{ total }})</span></h2>
        <!-- Âç°Áâá -->
        <div :class="props.customeCss">
            <!-- ËØÑËÆ∫ÂèëÂ∏ÉË°®Âçï -->
            <form>
                <div class="flex gap-3">
                    <!-- Â§¥ÂÉè -->
                    <div>
                        <img v-if="commentStore.userInfo.avatar && commentStore.userInfo.avatar.length > 0"
                            :src="commentStore.userInfo.avatar" class="w-10 h-10 rounded-full">
                        <svg v-else class="w-10 h-10 text-gray-400 dark:text-gray-400" aria-hidden="true"
                            xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                            <path
                                d="M10 0a10 10 0 1 0 10 10A10.011 10.011 0 0 0 10 0Zm0 5a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm0 13a8.949 8.949 0 0 1-4.951-1.488A3.987 3.987 0 0 1 9 13h2a3.987 3.987 0 0 1 3.951 3.512A8.949 8.949 0 0 1 10 18Z" />
                        </svg>
                    </div>
                    <!-- ÊòµÁß∞„ÄÅÈÇÆÁÆ±„ÄÅÁΩëÂùÄ„ÄÅËØÑËÆ∫ÂÜÖÂÆπ -->
                    <div class="grow">
                        <div class="flex items-center gap-5 flex-row">
                            <div class="flex basis-1/3">
                                <span
                                    class="inline-flex border-e-0 items-center px-3 text-xs text-gray-900 bg-gray-100 border rounded-e-0 border-gray-300 rounded-s-md dark:bg-gray-600 dark:text-gray-400 dark:border-gray-600">
                                    ÊòµÁß∞
                                </span>
                                <input @blur="onNicknameInputBlur" v-model="commentStore.userInfo.nickname"
                                    data-tooltip-target="nickname-tooltip-click" data-tooltip-trigger="click"
                                    type="text" id="website-admin"
                                    class="rounded-none rounded-e-lg  border text-gray-900 focus:ring-sky-500 
focus:border-sky-500 block flex-1 min-w-0 w-full text-xs border-gray-300 p-2.5  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-sky-500 dark:focus:border-sky-500"
                                    placeholder="ÂøÖÂ°´">
                                <!-- ÊòµÁß∞ Tooltip -->
                                <div id="nickname-tooltip-click" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 
text-xs font-medium text-white bg-gray-900 rounded-md shadow-sm opacity-0 tooltip dark:bg-gray-700">
                                    ËæìÂÖ• QQ Âè∑‰ºöËá™Âä®Ëé∑ÂèñÊòµÁß∞ÂíåÂ§¥ÂÉè
                                    <div class="tooltip-arrow" data-popper-arrow></div>
                                </div>
                            </div>
                            <div class="flex basis-1/3">
                                <span
                                    class="inline-flex border-e-0 items-center px-3 text-xs text-gray-900 bg-gray-100 border rounded-e-0 border-gray-300 rounded-s-md dark:bg-gray-600 dark:text-gray-400 dark:border-gray-600">
                                    ÈÇÆÁÆ±
                                </span>
                                <input v-model="commentStore.userInfo.mail" data-tooltip-target="mail-tooltip-click"
                                    data-tooltip-trigger="click" type="text" id="website-admin" class="rounded-none rounded-e-lg  border text-gray-900 focus:ring-sky-500 
focus:border-sky-500 block flex-1 min-w-0 w-full text-xs border-gray-300 p-2.5  dark:bg-gray-700 dark:border-gray-600 
dark:placeholder-gray-400 dark:text-white dark:focus:ring-sky-500 dark:focus:border-sky-500" placeholder="ÂøÖÂ°´">
                                <!-- ÈÇÆÁÆ± Tooltip -->
                                <div id="mail-tooltip-click" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 
text-xs font-medium text-white bg-gray-900 rounded-md shadow-sm opacity-0 tooltip dark:bg-gray-700">
                                    Êî∂Âà∞ÂõûÂ§çÂ∞Ü‰ºöÂèëÈÄÅÂà∞ÊÇ®ÁöÑÈÇÆÁÆ±
                                    <div class="tooltip-arrow" data-popper-arrow></div>
                                </div>
                            </div>
                            <div class="flex basis-1/3">
                                <span
                                    class="inline-flex border-e-0 items-center px-3 text-xs text-gray-900 bg-gray-100 border rounded-e-0 border-gray-300 rounded-s-md dark:bg-gray-600 dark:text-gray-400 dark:border-gray-600">
                                    ÁΩëÂùÄ
                                </span>
                                <input v-model="commentStore.userInfo.website"
                                    data-tooltip-target="website-tooltip-click" data-tooltip-trigger="click" type="text"
                                    id="website-admin" class="rounded-none rounded-e-lg  border text-gray-900 
focus:ring-sky-500 focus:border-sky-500 block flex-1 min-w-0 w-full text-xs border-gray-300 p-2.5  dark:bg-gray-700
dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-sky-500 dark:focus:border-sky-500"
                                    placeholder="ÈÄâÂ°´">
                                <!-- ÁΩëÂùÄ Tooltip -->
                                <div id="website-tooltip-click" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 
text-xs font-medium text-white bg-gray-900 rounded-md shadow-sm opacity-0 tooltip dark:bg-gray-700">
                                    ÂèØÈÄöËøáÁÇπÂáªÂ§¥ÂÉèËÆøÈóÆ‰Ω†ÁöÑÁΩëÁ´ô (ÈùûÂøÖÂ°´)
                                    <div class="tooltip-arrow" data-popper-arrow></div>
                                </div>

                            </div>
                        </div>
                        <div
                            class="w-full mb-4 mt-4 border border-gray-200 rounded-lg bg-gray-50 dark:bg-gray-700 dark:border-gray-600">
                            <div class="px-4 py-2 bg-white rounded-t-lg dark:bg-gray-800">
                                <label for="comment" class="sr-only">Your comment</label>
                                <textarea id="comment" rows="4" v-model="commentForm.content"
                                    class="w-full px-0 text-sm text-gray-900 bg-white border-0 dark:bg-gray-800 focus:ring-0 dark:text-white dark:placeholder-gray-400"
                                    placeholder="ÂèëË°®‰∏Ä‰∏™ÂèãÂñÑÁöÑËØÑËÆ∫Âêß..." required></textarea>
                            </div>
                            <div class="flex items-center justify-between px-3 py-2 border-t dark:border-gray-600">
                                <div @click="onPublishCommentClick" class="inline-flex items-center py-2.5 px-4 text-xs font-medium text-center text-white 
bg-sky-600 rounded-lg focus:ring-4 focus:ring-sky-200 dark:focus:ring-sky-900 hover:bg-sky-700">
                                    ÂèëÈÄÅ
                                </div>
                                <div class="flex ps-0 space-x-1 rtl:space-x-reverse sm:ps-2">
                                    <!-- Emoji -->
                                    <div data-popover-target="popover-emoji" type="button"
                                        class="inline-flex justify-center items-center p-2 text-gray-500 rounded cursor-pointer hover:text-gray-900 hover:bg-gray-100 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-600">
                                        <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                                            fill="none" viewBox="0 0 24 24">
                                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                                stroke-width="2"
                                                d="M15 9h0M9 9h0m12 3a9 9 0 1 1-18 0 9 9 0 0 1 18 0ZM7 13c0 1 .5 2.4 1.5 3.2a5.5 5.5 0 0 0 7 0c1-.8 1.5-2.2 1.5-3.2 0 0-2 1-5 1s-5-1-5-1Z" />
                                        </svg>
                                    </div>

                                    <!-- Emoji Popover -->
                                    <div data-popover id="popover-emoji" role="tooltip"
                                        class="absolute z-10 invisible inline-block w-64 text-sm text-gray-500 transition-opacity duration-300 bg-white border border-gray-200 rounded-lg shadow-sm opacity-0 dark:text-gray-400 dark:border-gray-600 dark:bg-gray-800">
                                        <div class="p-2">
                                            <div class="grid grid-cols-6 gap-2">
                                                <div v-for="(emoji, index) in emojis" :key="index"
                                                    class="text-2xl hover:cursor-pointer" @click="addEmoji(emoji)">{{
            emoji }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>

            <!-- ËØÑËÆ∫ÂàóË°® -->
            <div v-if="comments && comments.length > 0" v-for="(comment, index) in comments" :key="index">

                <!-- ËæπÁïåÁ∫ø -->
                <div v-if="index > 0" class="border-t ml-12 mt-5  border-gray-100 dark:border-gray-700"></div>

                <!-- ‰∏ÄÁ∫ßËØÑËÆ∫ -->
                <div class="flex gap-3 mt-5">
                    <!-- Â∑¶ËæπÂ§¥ÂÉèÊ†è -->
                    <div>
                        <a v-if="comment.website && comment.website.length > 0" @click="jumpToWebsite(comment.website)"
                            class="cursor-pointer">
                            <img v-if="comment.avatar && comment.avatar.length > 0" :src="comment.avatar"
                                class="w-10 h-10 rounded-full">
                            <svg v-else class="w-10 h-10 text-gray-400 rounded-full dark:text-gray-400"
                                aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                                viewBox="0 0 20 20">
                                <path
                                    d="M10 0a10 10 0 1 0 10 10A10.011 10.011 0 0 0 10 0Zm0 5a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm0 13a8.949 8.949 0 0 1-4.951-1.488A3.987 3.987 0 0 1 9 13h2a3.987 3.987 0 0 1 3.951 3.512A8.949 8.949 0 0 1 10 18Z" />
                            </svg>
                        </a>
                        <div v-else>
                            <img v-if="comment.avatar && comment.avatar.length > 0" :src="comment.avatar"
                                class="w-10 h-10 rounded-full">
                            <svg v-else class="w-10 h-10 text-gray-400 rounded-full dark:text-gray-400"
                                aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                                viewBox="0 0 20 20">
                                <path
                                    d="M10 0a10 10 0 1 0 10 10A10.011 10.011 0 0 0 10 0Zm0 5a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm0 13a8.949 8.949 0 0 1-4.951-1.488A3.987 3.987 0 0 1 9 13h2a3.987 3.987 0 0 1 3.951 3.512A8.949 8.949 0 0 1 10 18Z" />
                            </svg>
                        </div>
                    </div>
                    <!-- Âè≥ËæπËØÑËÆ∫‰ø°ÊÅØ -->
                    <div class="flex flex-col gap-2 grow">
                        <!-- ÊòµÁß∞ -->
                        <div class="text-xs text-[#FB7299] font-bold">{{ comment.nickname }}</div>
                        <!-- ËØÑËÆ∫ÂÜÖÂÆπ -->
                        <div class="text-sm dark:text-gray-400">{{ comment.content }}</div>
                        <!-- Meta ‰ø°ÊÅØ -->
                        <div class="flex items-center text-xs text-gray-400">
                            <!-- ÂèëÂ∏ÉÊó∂Èó¥ -->
                            <div>{{ comment.createTime }}</div>
                            <div class="text-gray-400 cursor-pointer ml-4 hover:text-sky-600"
                                @click="showReplyForm(index, comment.nickname, comment.id, comment.id)">
                                ÂõûÂ§ç
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ‰∫åÁ∫ßËØÑËÆ∫ -->
                <div class="ml-12" v-if="comment.childComments && comment.childComments.length > 0">
                    <div v-for="(childComment, index2) in comment.childComments" :key="index2">
                        <!-- Â§¥ÂÉè„ÄÅÊòµÁß∞„ÄÅËØÑËÆ∫ÂÜÖÂÆπ -->
                        <div class="flex items-center gap-3 mt-5">
                            <!-- Â∑¶ËæπÂ§¥ÂÉèÊ†è -->
                            <div>
                                <a v-if="childComment.website && childComment.website.length > 0"
                                    @click="jumpToWebsite(childComment.website)" class="cursor-pointer">
                                    <img v-if="childComment.avatar && childComment.avatar.length > 0"
                                        :src="childComment.avatar" class="w-6 h-6 rounded-full">
                                    <svg v-else class="w-6 h-6 text-gray-400 rounded-full dark:text-gray-400"
                                        aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                                        viewBox="0 0 20 20">
                                        <path
                                            d="M10 0a10 10 0 1 0 10 10A10.011 10.011 0 0 0 10 0Zm0 5a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm0 13a8.949 8.949 0 0 1-4.951-1.488A3.987 3.987 0 0 1 9 13h2a3.987 3.987 0 0 1 3.951 3.512A8.949 8.949 0 0 1 10 18Z" />
                                    </svg>
                                </a>
                                <div v-else>
                                    <img v-if="childComment.avatar && childComment.avatar.length > 0"
                                        :src="childComment.avatar" class="w-6 h-6 rounded-full">
                                    <svg v-else class="w-6 h-6 text-gray-400 rounded-full dark:text-gray-400"
                                        aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                                        viewBox="0 0 20 20">
                                        <path
                                            d="M10 0a10 10 0 1 0 10 10A10.011 10.011 0 0 0 10 0Zm0 5a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm0 13a8.949 8.949 0 0 1-4.951-1.488A3.987 3.987 0 0 1 9 13h2a3.987 3.987 0 0 1 3.951 3.512A8.949 8.949 0 0 1 10 18Z" />
                                    </svg>
                                </div>
                            </div>
                            <!-- ÊòµÁß∞ -->
                            <div class="text-xs text-[#FB7299] font-bold">
                                {{ childComment.nickname }}
                                <!-- „ÄêÂõûÂ§ç @xxx„Äë -->
                                <span v-if="childComment.replyNickname" class="text-gray-400 font-normal ml-1 mr-1">ÂõûÂ§ç
                                    <span class="text-sky-600 font-normal text-sm">@{{ childComment.replyNickname
                                        }}</span>
                                    <span class="text-gray-400"> :</span>
                                </span>
                            </div>
                            <!-- ËØÑËÆ∫ÂÜÖÂÆπ -->
                            <div class="text-sm dark:text-gray-400">{{ childComment.content }}</div>
                        </div>
                        <!-- Meta ‰ø°ÊÅØ -->
                        <div class="ml-9 mt-1 flex items-center text-xs text-gray-400">
                            <!-- ÂèëÂ∏ÉÊó∂Èó¥ -->
                            <div>{{ childComment.createTime }}</div>
                            <div class="text-gray-400 cursor-pointer ml-4 hover:text-sky-600"
                                @click="showReplyForm(index, childComment.nickname, childComment.id, comment.id)">
                                ÂõûÂ§ç
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ‰∫åÁ∫ßËØÑËÆ∫ÂõûÂ§çË°®Âçï -->
                <form class="ml-12 mt-5" v-if="comment.isShowReplyForm">
                    <div class="flex gap-3">
                        <!-- Â§¥ÂÉè -->
                        <div>
                            <img v-if="commentStore.userInfo.avatar && commentStore.userInfo.avatar.length > 0"
                                :src="commentStore.userInfo.avatar" class="w-10 h-10 rounded-full">
                            <svg v-else class="w-10 h-10 text-gray-400 dark:text-gray-400" aria-hidden="true"
                                xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                                <path
                                    d="M10 0a10 10 0 1 0 10 10A10.011 10.011 0 0 0 10 0Zm0 5a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm0 13a8.949 8.949 0 0 1-4.951-1.488A3.987 3.987 0 0 1 9 13h2a3.987 3.987 0 0 1 3.951 3.512A8.949 8.949 0 0 1 10 18Z" />
                            </svg>
                        </div>
                        <!-- ÊòµÁß∞„ÄÅÈÇÆÁÆ±„ÄÅÁΩëÂùÄ„ÄÅËØÑËÆ∫ÂÜÖÂÆπ -->
                        <div class="grow">
                            <div class="flex items-center gap-5 flex-row">
                                <div class="flex basis-1/3">
                                    <span
                                        class="inline-flex border-e-0 items-center px-3 text-xs text-gray-900 bg-gray-100 border rounded-e-0 border-gray-300 rounded-s-md dark:bg-gray-600 dark:text-gray-400 dark:border-gray-600">
                                        ÊòµÁß∞
                                    </span>
                                    <input @blur="onNicknameInputBlur" v-model="commentStore.userInfo.nickname"
                                        data-tooltip-target="nickname-tooltip-click2" data-tooltip-trigger="click"
                                        type="text" id="website-admin"
                                        class="rounded-none rounded-e-lg  border text-gray-900 focus:ring-sky-500 
focus:border-sky-500 block flex-1 min-w-0 w-full text-xs border-gray-300 p-2.5  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-sky-500 dark:focus:border-sky-500"
                                        placeholder="ÂøÖÂ°´">
                                    <!-- ÊòµÁß∞ Tooltip -->
                                    <div id="nickname-tooltip-click2" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 
text-xs font-medium text-white bg-gray-900 rounded-md shadow-sm opacity-0 tooltip dark:bg-gray-700">
                                        ËæìÂÖ• QQ Âè∑‰ºöËá™Âä®Ëé∑ÂèñÊòµÁß∞ÂíåÂ§¥ÂÉè
                                        <div class="tooltip-arrow" data-popper-arrow></div>
                                    </div>
                                </div>
                                <div class="flex basis-1/3">
                                    <span
                                        class="inline-flex border-e-0 items-center px-3 text-xs text-gray-900 bg-gray-100 border rounded-e-0 border-gray-300 rounded-s-md dark:bg-gray-600 dark:text-gray-400 dark:border-gray-600">
                                        ÈÇÆÁÆ±
                                    </span>
                                    <input v-model="commentStore.userInfo.mail"
                                        data-tooltip-target="mail-tooltip-click2" data-tooltip-trigger="click"
                                        type="text" id="website-admin" class="rounded-none rounded-e-lg  border text-gray-900 focus:ring-sky-500 
focus:border-sky-500 block flex-1 min-w-0 w-full text-xs border-gray-300 p-2.5  dark:bg-gray-700 dark:border-gray-600 
dark:placeholder-gray-400 dark:text-white dark:focus:ring-sky-500 dark:focus:border-sky-500" placeholder="ÂøÖÂ°´">
                                    <!-- ÈÇÆÁÆ± Tooltip -->
                                    <div id="mail-tooltip-click2" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 
text-xs font-medium text-white bg-gray-900 rounded-md shadow-sm opacity-0 tooltip dark:bg-gray-700">
                                        Êî∂Âà∞ÂõûÂ§çÂ∞Ü‰ºöÂèëÈÄÅÂà∞ÊÇ®ÁöÑÈÇÆÁÆ±
                                        <div class="tooltip-arrow" data-popper-arrow></div>
                                    </div>
                                </div>
                                <div class="flex basis-1/3">
                                    <span
                                        class="inline-flex border-e-0 items-center px-3 text-xs text-gray-900 bg-gray-100 border rounded-e-0 border-gray-300 rounded-s-md dark:bg-gray-600 dark:text-gray-400 dark:border-gray-600">
                                        ÁΩëÂùÄ
                                    </span>
                                    <input v-model="commentStore.userInfo.website"
                                        data-tooltip-target="website-tooltip-click2" data-tooltip-trigger="click"
                                        type="text" id="website-admin" class="rounded-none rounded-e-lg  border text-gray-900 
focus:ring-sky-500 focus:border-sky-500 block flex-1 min-w-0 w-full text-xs border-gray-300 p-2.5  dark:bg-gray-700
dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-sky-500 dark:focus:border-sky-500"
                                        placeholder="ÈÄâÂ°´">
                                    <!-- ÁΩëÂùÄ Tooltip -->
                                    <div id="website-tooltip-click2" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 
text-xs font-medium text-white bg-gray-900 rounded-md shadow-sm opacity-0 tooltip dark:bg-gray-700">
                                        ÂèØÈÄöËøáÁÇπÂáªÂ§¥ÂÉèËÆøÈóÆ‰Ω†ÁöÑÁΩëÁ´ô (ÈùûÂøÖÂ°´)
                                        <div class="tooltip-arrow" data-popper-arrow></div>
                                    </div>

                                </div>
                            </div>
                            <div
                                class="w-full mb-4 mt-4 border border-gray-200 rounded-lg bg-gray-50 dark:bg-gray-700 dark:border-gray-600">
                                <div class="px-4 py-2 bg-white rounded-t-lg dark:bg-gray-800">
                                    <label for="comment" class="sr-only">Your comment</label>
                                    <textarea id="comment" rows="4" v-model="replyContent"
                                        class="w-full px-0 text-sm text-gray-900 bg-white border-0 dark:bg-gray-800 focus:ring-0 dark:text-white dark:placeholder-gray-400"
                                        :placeholder="replyPlaceholderText" required></textarea>
                                </div>
                                <div class="flex items-center justify-between px-3 py-2 border-t dark:border-gray-600">
                                    <div @click="onReplyContentSubmit" class="inline-flex items-center py-2.5 px-4 text-xs font-medium text-center text-white 
bg-sky-600 rounded-lg focus:ring-4 focus:ring-sky-200 dark:focus:ring-sky-900 hover:bg-sky-700">
                                        ÂèëÈÄÅ
                                    </div>
                                    <div class="flex ps-0 space-x-1 rtl:space-x-reverse sm:ps-2">
                                        <!-- Emoji -->
                                        <div data-popover-target="popover-emoji2" type="button"
                                            class="inline-flex justify-center items-center p-2 text-gray-500 rounded cursor-pointer hover:text-gray-900 hover:bg-gray-100 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-600">
                                            <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                                                fill="none" viewBox="0 0 24 24">
                                                <path stroke="currentColor" stroke-linecap="round"
                                                    stroke-linejoin="round" stroke-width="2"
                                                    d="M15 9h0M9 9h0m12 3a9 9 0 1 1-18 0 9 9 0 0 1 18 0ZM7 13c0 1 .5 2.4 1.5 3.2a5.5 5.5 0 0 0 7 0c1-.8 1.5-2.2 1.5-3.2 0 0-2 1-5 1s-5-1-5-1Z" />
                                            </svg>
                                        </div>

                                        <!-- Emoji Popover -->
                                        <div data-popover id="popover-emoji2" role="tooltip"
                                            class="absolute z-10 invisible inline-block w-64 text-sm text-gray-500 transition-opacity duration-300 bg-white border border-gray-200 rounded-lg shadow-sm opacity-0 dark:text-gray-400 dark:border-gray-600 dark:bg-gray-800">
                                            <div class="p-2">
                                                <div class="grid grid-cols-6 gap-2">
                                                    <div v-for="(emoji, index) in emojis" :key="index"
                                                        class="text-2xl hover:cursor-pointer"
                                                        @click="addReplyEmoji(emoji)">
                                                        {{
                                                        emoji }}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>


            </div>
            <!-- Ê≤°ÊúâËØÑËÆ∫ÁöÑÊèêÁ§∫ÊñáÂ≠ó -->
            <div v-else class="flex items-center mt-10 mb-10 justify-center text-gray-400">ËøòÊ≤°Êúâ‰ªª‰ΩïËØÑËÆ∫Âìü~</div>


        </div>
    </div>
</template>

<script setup>
import { ref, reactive, onMounted, nextTick } from 'vue'
import {
    initTooltips, initPopovers
} from 'flowbite'
import { useCommentStore } from '@/stores/comment'
import { getUserInfoByQQ, publishComment, getComments } from '@/api/frontend/comment'
import { useRoute } from 'vue-router'
import { showMessage } from '@/composables/utils'

const route = useRoute()

const commentStore = useCommentStore()

// ÂØπÂ§ñÊö¥Èú≤Â±ûÊÄß
const props = defineProps({
    customeCss: {
        type: String,
        default: 'w-full px-5 py-10 mb-3 bg-white border border-gray-200 rounded-lg dark:bg-gray-800 dark:border-gray-700'
    }
})

onMounted(() => {
    initTooltips()
    initPopovers()
})

// emojis Ë°®ÊÉÖÁ¨¶Âè∑
const emojis = ref(['üòÉ', 'üòÅ', 'üòÖ', 'üòÇ', 'üòç', 'üòú', 'üòù', 'ü§ë', 'ü•µ', 'ü•∞', 'üòô', 'üòé'
    , 'üòµ', 'üò≠', 'üò±', 'üòñ', 'ü•≥', 'üëΩ', 'üôà', 'ü§°', 'üò§', 'üí£', 'üíØ', 'üí¢', '‚ù§Ô∏è', 'üëç', 'üëè', 'üëã', 'üëå', 'ü§è', 'üôè'])

// ËØÑËÆ∫Ë°®Âçï
const commentForm = reactive({
    avatar: '',
    content: '',
    mail: '',
    nickname: '',
    routerUrl: route.path,
    website: '',
    replyCommentId: null,
    parentCommentId: null
})

// ÂàùÂßãÂåñ commentForm Ë°®ÂçïÂØπË±°‰∏≠ÁöÑÁî®Êà∑‰ø°ÊÅØ
function initFormCommentUserInfo() {
    commentForm.avatar = commentStore.userInfo.avatar
    commentForm.mail = commentStore.userInfo.mail
    commentForm.nickname = commentStore.userInfo.nickname
    commentForm.website = commentStore.userInfo.website
}
initFormCommentUserInfo()

// ÈÇÆÁÆ±Ê≠£Âàô
const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
// ‰∏ÄÁ∫ßËØÑËÆ∫ÂèëÂ∏ÉÁÇπÂáª‰∫ã‰ª∂
const onPublishCommentClick = () => {
    initFormCommentUserInfo()
    // Ê†°È™å
    if (commentForm.nickname.length === 0) {
        showMessage('ËØ∑Â°´ÂÜô QQ Âè∑ÊàñÊòµÁß∞', 'warning')
        return
    }
    if (commentForm.mail.length === 0 || !emailRegex.test(commentForm.mail)) {
        showMessage('ÈÇÆÁÆ±Ê†ºÂºè‰∏çÊ≠£Á°Æ', 'warning')
        return
    }
    if (commentForm.content.length === 0) {
        showMessage('ËØ∑Â°´ÂÜôËØÑËÆ∫ÂÜÖÂÆπ', 'warning')
        return
    }

    publishComment(commentForm).then(res => {
        if (!res.success) {
            // Ëé∑ÂèñÊúçÂä°Á´ØËøîÂõûÁöÑÈîôËØØÊ∂àÊÅØ
            let message = res.message
            // ÊèêÁ§∫ÈîôËØØÊ∂àÊÅØ
            showMessage(message, 'error')
            return
        }

        showMessage('ËØÑËÆ∫ÂèëÂ∏ÉÊàêÂäü')
        // Â∞ÜË°®ÂçïÂØπË±°‰∏≠ÁöÑ content ËØÑËÆ∫ÂÜÖÂÆπÁΩÆÁ©∫
        commentForm.content = ''
        // ÈáçÊñ∞Ê∏≤ÊüìË°®ÂçïÂàóË°®
        initComments()
    })
}

// Ê∑ªÂä† Emoji Ë°®ÊÉÖ
const addEmoji = (emoji) => {
    commentForm.content = commentForm.content + emoji
}

// ÊòµÁß∞ËæìÂÖ•Ê°Ü blur ‰∫ã‰ª∂
const onNicknameInputBlur = () => {
    let nickname = commentStore.userInfo.nickname
    // Ê†°È™åÊòµÁß∞ÊòØÂê¶ÊòØÁ∫ØÊï∞Â≠ó
    if (!checkIfPureNumber(nickname)) {
        return
    }

    // Ëã•ÊòØÔºåËØ∑Ê±ÇÂêéÁ´ØÊé•Âè£ÔºåÊ†πÊçÆ QQ Âè∑Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØ
    getUserInfoByQQ(nickname).then(res => {
        if (!res.success) {
            // ÊèêÁ§∫ÈîôËØØÊ∂àÊÅØ
            showMessage('Ëé∑Âèñ QQ ‰ø°ÊÅØÂ§±Ë¥•', 'error')
            return
        }

        commentStore.userInfo.avatar = res.data.avatar
        commentStore.userInfo.nickname = res.data.nickname
        commentStore.userInfo.mail = res.data.mail
    })
}

// QQ Âè∑Ê†°È™åÔºåÊòØÂê¶ÊòØÁ∫ØÊï∞Â≠ó 
function checkIfPureNumber(text) {
    const trimmedValue = text.trim();
    return /^\d+$/.test(trimmedValue);
}

// ËØÑËÆ∫Êï∞ÁªÑ
const comments = ref([])
// ËØÑËÆ∫ÊÄªÊï∞Èáè
const total = ref(0)

function initComments() {
    // Ëé∑ÂèñÂΩìÂâçË∑ØÁî±‰∏ãÁöÑÊâÄÊúâËØÑËÆ∫
    getComments(route.path).then(res => {
        if (res.success) {
            total.value = res.data.total
            comments.value = res.data.comments
        }
    })
}
initComments()

// ÂõûÂ§ç textarea ÁöÑ placeholder ÊèêÁ§∫ÊñáÂ≠ó
const replyPlaceholderText = ref('ÂèëË°®‰∏Ä‰∏™ÂèãÂñÑÁöÑËØÑËÆ∫Âêß...')
// ÂõûÂ§çÁöÑËØÑËÆ∫
const replyContent = ref('')

// ÂΩìÂâçÂõûÂ§çÁöÑËØÑËÆ∫ ID
const currReplyCommentId = ref(null)
// ÂΩìÂâçÂõûÂ§çÁöÑÁà∂Á∫ß ID
const currParentCommentId = ref(null)

// Â±ïÁ§∫ÂõûÂ§çË°®Âçï
const showReplyForm = (index, nickname, replyCommentId, parentCommentId) => {
    currReplyCommentId.value = replyCommentId
    currParentCommentId.value = parentCommentId
    // ÂÖàÂ∞ÜËØÑËÆ∫Êï∞ÁªÑ‰∏≠‰∏ÄÁ∫ßËØÑËÆ∫ÁöÑÊâÄÊúâ isShowReplyForm Â≠óÊÆµËÆæÁΩÆ‰∏∫ false
    comments.value.forEach(comment => comment.isShowReplyForm = false)
    // ÊãøÂà∞ÂΩìÂâç‰∏ãÊ†áÁöÑËØÑËÆ∫
    let comment = comments.value[index]
    // isShowReplyForm ÁΩÆ‰∏∫ true
    comment.isShowReplyForm = true
    // Âä®ÊÄÅËÆæÁΩÆËØÑËÆ∫ÂõûÂ§çË°®Âçï‰∏≠ÁöÑ textarea ÁöÑ placeholder ÊèêÁ§∫ÊñáÂ≠ó
    replyPlaceholderText.value = 'ÂõûÂ§ç @' + nickname + ':'

    nextTick(() => {
        initPopovers(),
            initTooltips()
    })
}

// ËØÑËÆ∫ÂõûÂ§çË°®ÂçïÔºöÊ∑ªÂä† Emoji
const addReplyEmoji = (emoji) => {
    replyContent.value = replyContent.value + emoji
}

// ËØÑËÆ∫ÂõûÂ§çÂèëÈÄÅ‰∫ã‰ª∂
const onReplyContentSubmit = () => {
    initFormCommentUserInfo()
    // Ê†°È™å
    if (commentForm.nickname.length === 0) {
        showMessage('ËØ∑Â°´ÂÜô QQ Âè∑ÊàñÊòµÁß∞', 'warning')
        return
    }
    if (commentForm.mail.length === 0 || !emailRegex.test(commentForm.mail)) {
        showMessage('ÈÇÆÁÆ±Ê†ºÂºè‰∏çÊ≠£Á°Æ', 'warning')
        return
    }
    if (replyContent.value.length === 0) {
        showMessage('ËØ∑Â°´ÂÜôÂõûÂ§çÂÜÖÂÆπ', 'warning')
        return
    }
    // ËØÑËÆ∫ÂõûÂ§çÂÜÖÂÆπ
    commentForm.content = replyContent.value
    commentForm.replyCommentId = currReplyCommentId.value
    commentForm.parentCommentId = currParentCommentId.value

    // ËØ∑Ê±ÇÊé•Âè£
    publishComment(commentForm).then(res => {
        if (!res.success) {
            // Ëé∑ÂèñÊúçÂä°Á´ØËøîÂõûÁöÑÈîôËØØÊ∂àÊÅØ
            let message = res.message
            // ÊèêÁ§∫ÈîôËØØÊ∂àÊÅØ
            showMessage(message, 'error')
            return
        }

        showMessage('ÂõûÂ§çËØÑËÆ∫ÊàêÂäü')
        // Â∞ÜËØÑËÆ∫ÂõûÂ§çÁöÑÂÜÖÂÆπÁΩÆÁ©∫
        replyContent.value = ''
        commentForm.content = ''
        // ÈáçÊñ∞Ê∏≤ÊüìËØÑËÆ∫ÂàóË°®
        initComments()
    })
}

// Ë∑≥ËΩ¨ËØÑËÆ∫Áî®Êà∑ÁΩëÂùÄ
const jumpToWebsite = (url) => {
    // Âú®Êñ∞Á™óÂè£ËÆøÈóÆÊñ∞ÁöÑÈìæÊé•Âú∞ÂùÄ
    window.open(url.startsWith('http') ? url : 'http://' + url, '_blank');
}

</script>